<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>AsesorateSAS</title>
        <link rel="stylesheet" type="text/css" href="styles/main.css">
        <link rel="stylesheet" type="text/css" href="styles/registro.css">
        <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    </head>
    <body>
        <header>
                <h1>Asesorate S.A.S</h1>
                <ul class="enlaces">
                    <li><a href="registro_aspirante.html">Registro aspirante</a></li>
                    <li><a href="registro.html">Registro estudiante</a></li>
                    <li><a href="ingresar.html">Ingresar</a></li>
                </ul>
            </header>
        <div class="ingreso">
            <h1>Ingrese sus datos de usuario</h1>
            <form action="" id="form" method="get">
                <input type="email" id="correo" name="correo" placeholder="Correo" required>
                <br>
                <input type="password" id="contrasena" name="password" placeholder="ContraseÃ±a" required>
                <br>
                <div class="botones">
                    <a href="index.html">Cancelar</a>
                    <button type="submit" id="submit" name="submit"><i class="fa fa-chevron-circle-right"></i>Confirmar</button>
                </div>
            </form>
        </div>
        <p id='response' style="font-size: 15px;color:red">

        </p>
    </body>
    <script>
        $("form").submit(function(event) {
            event.preventDefault();
            var correo = jQuery("[name=correo]").val();
            var password = jQuery("[name=password]").val();
            fetch('https://fathomless-mesa-60059.herokuapp.com/api/logged', {
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json, text-plain, */*"
                },
                method: 'post',
                credentials: "same-origin",
                body: JSON.stringify({
                    correo: correo,
                    password: password
                })
            })
                .then((data) => data.json())
                .then(res =>{
                    var responseText = document.getElementById('response');
                    message = res['message'];
                    console.log(res);
                    if(message != 'ingresado'){
                        responseText.innerHTML = message;
                    }else{
                        localStorage.setItem("cedula",res['cedula']);
                        localStorage.setItem("pass", res['pass']);
                        if(res['rol'][0]['rol'] == 'Estudiante'){
                            location.replace('http://www.asesorate.tk/frontend/cotizaciones.html');
                        }
                        else if(res['rol'][0]['rol'] == 'Administrador'){
                            location.replace('http://www.asesorate.tk/frontend/administrador.html');
                        }
                    }
                })
                .catch(function(error){
                    console.log(error);
                });
        });
    </script>
</html>
